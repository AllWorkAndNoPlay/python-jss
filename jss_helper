#!/usr/bin/python
"""jss_helper

Command line utility using jss_helper.py

Shea Craig 2014

"""

# Be careful not to have name collisions due helper functions calling similar
# functions from jss_helper!
from jss_helper import *
import argparse


def get_all_policies(args):
    """Helper function."""
    results = get_policies()
    pprint(results)


def get_group_policies(args):
    """Helper function."""
    results = get_policies_scoped_to_computer_group(args.group)
    print("Results:")
    for result in results:
        pprint(result[0])
        pprint(result[1])


def policy(args):
    """Helper function."""
    result = get_policy_by_id(args.id)
    pprint(result)


def policy_by_name(args):
    """Helper function."""
    result = get_policy_by_name(args.name)
    pprint(result)


def md_configps(args):
    """Helper function."""
    result = get_md_configps()
    pprint(result)


def md_configp(args):
    """Helper function."""
    result = get_configp_by_id(args.id)
    pprint(result)


def md_configp_group(args):
    """Helper function."""
    results = get_md_configp_scoped_to_group(args.group)
    print("Results:")
    for result in results:
        pprint(result[0])
        pprint(result[1])


#To be integrated
#import jss
#
#jss_prefs = jss.JSSPrefs()
#j = jss.JSS(jss_prefs)
#
#for p in j.Policy():
#    a = j.Policy(p.xml.find('id').text)
#    #print a.pprint()
#    search = 'scope/computer_groups/computer_group'
#    for computer_group in a.xml.findall(search):
#        if computer_group.findtext('name') == 'Testing':
#            print('Hit, hit!')


def main():
    """Run as a cli command."""

    # Create our argument parser
    parser = argparse.ArgumentParser(description="Query the JSS.")
    subparser = parser.add_subparsers(dest='subparser_name')

    # get_policies
    help = "Get a list of all policies and their IDs."
    subparser_policies = subparser.add_parser('policies', help=help)
    subparser_policies.set_defaults(func=get_all_policies)

    # policy
    help = "Get a policy by ID."
    subparser_policy = subparser.add_parser('policy', help=help)
    subparser_policy.add_argument('id', help="ID of policy to retrieve.")
    subparser_policy.set_defaults(func=policy)

    # policy_by_name
    help = "Get a policy by name."
    subparser_policy_by_name = subparser.add_parser('policy_by_name',
                                                    help=help)
    help = "Name of policy to retrieve."
    subparser_policy_by_name.add_argument('name', help=help)
    subparser_policy_by_name.set_defaults(func=policy_by_name)

    # policy_by_group
    help = "Lists all policies scoped to provided group."
    subparser_policy_by_group = subparser.add_parser('policy_by_group',
                                                     help=help)
    subparser_policy_by_group.add_argument('group', help="Group name to query.")
    subparser_policy_by_group.set_defaults(func=get_group_policies)

    # md_configps
    help = "Get a list of all mobile device configuration profiles, and " \
            "their IDs."
    subparser_md_configps = subparser.add_parser('md_configps', help=help)
    subparser_md_configps.set_defaults(func=md_configps)

    # md_configp
    help = "Get a mobile device configuration profile by ID."
    subparser_md_configp = subparser.add_parser('md_configp', help=help)
    subparser_md_configp.add_argument('id', help="ID of policy to retrieve.")
    subparser_md_configp.set_defaults(func=md_configp)

    # md_config_by_group
    help = "List all configuration profiles scoped to group"
    subparser_md_configp_by_group = subparser.add_parser('md_configp_by_group',
                                                help=help)
    subparser_md_configp_by_group.add_argument('group',
                                               help="Group name to query.")
    subparser_md_configp_by_group.set_defaults(func=md_configp_group)

    # Parse the args and then call their target function
    args = parser.parse_args()
    args.func(args)


if __name__ == '__main__':
    main()
